import{s as Ce,B as me,C as Ie,D as Ue,E as Qe,F as Ae,G as Ge,e as m,t as C,a as T,c as b,b as k,d as N,f as _,g as $,p as O,i as ue,h as c,j,u as Je,k as Ve,P as Ke,H as Xe,n as Ze}from"../chunks/scheduler.bQlOXBkt.js";import{S as Ne,i as je,b as be,d as ve,m as ke,t as V,a as ee,e as De,c as qe,g as Pe}from"../chunks/index.dknh01mB.js";import{e as ye}from"../chunks/each.anRlpCm9.js";import{c as Te,i as xe}from"../chunks/i18n.Mah0M8rZ.js";import{g as et,a as tt}from"../chunks/spread.rEx3vLA9.js";import{I as st}from"../chunks/Icon.9NkTZT6r.js";import{e as at}from"../chunks/forms.uhvzcuB7.js";import"../chunks/ProgressBar.svelte_svelte_type_style_lang.JlGIzIKZ.js";import{P as nt}from"../chunks/ProgressRadial.xsBlPM_P.js";function w(a){const e=Object.prototype.toString.call(a);return a instanceof Date||typeof a=="object"&&e==="[object Date]"?new a.constructor(+a):typeof a=="number"||e==="[object Number]"||typeof a=="string"||e==="[object String]"?new Date(a):new Date(NaN)}const lt=365.2425,rt=6048e5,ot=864e5,ct=6e4,ut=36e5,We=3600,it=60,pe=We*24,ft=pe*7,Be=pe*lt,ze=Be/12,dt=ze*3;let ht={};function _t(){return ht}function $e(a,e){var v,i,S,E;const s=_t(),t=(e==null?void 0:e.weekStartsOn)??((i=(v=e==null?void 0:e.locale)==null?void 0:v.options)==null?void 0:i.weekStartsOn)??s.weekStartsOn??((E=(S=s.locale)==null?void 0:S.options)==null?void 0:E.weekStartsOn)??0,n=w(a),l=n.getDay(),r=(l<t?7:0)+l-t;return n.setDate(n.getDate()-r),n.setHours(0,0,0,0),n}function we(a){const e=w(a);return e.setHours(0,0,0,0),e}function ie(a){const e=w(a),s=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return s.setUTCFullYear(e.getFullYear()),+a-+s}function de(a,e){const s=we(a),t=we(e),n=+s-ie(s),l=+t-ie(t);return Math.round((n-l)/ot)}function Oe(a,e){const s=w(a),t=w(e),n=s.getFullYear()-t.getFullYear(),l=s.getMonth()-t.getMonth();return n*12+l}function Se(a){const e=w(a);return Math.trunc(e.getMonth()/3)+1}function he(a,e){const s=w(a),t=w(e),n=s.getFullYear()-t.getFullYear(),l=Se(s)-Se(t);return n*4+l}function He(a,e,s){const t=$e(a,s),n=$e(e,s),l=+t-ie(t),r=+n-ie(n);return Math.round((l-r)/rt)}function _e(a,e){const s=w(a),t=w(e);return s.getFullYear()-t.getFullYear()}function Me(a){return e=>{const t=(a?Math[a]:Math.trunc)(e);return t===0?0:t}}function Ee(a,e){return+w(a)-+w(e)}function Re(a,e,s){const t=Ee(a,e)/ut;return Me(s==null?void 0:s.roundingMethod)(t)}function Fe(a,e,s){const t=Ee(a,e)/ct;return Me(s==null?void 0:s.roundingMethod)(t)}function ge(a,e,s){const t=Ee(a,e)/1e3;return Me(s==null?void 0:s.roundingMethod)(t)}function ce(a,e,s){let t=0,n;const l=w(a),r=w(e);if(s!=null&&s.unit)n=s==null?void 0:s.unit,n==="second"?t=ge(l,r):n==="minute"?t=Fe(l,r):n==="hour"?t=Re(l,r):n==="day"?t=de(l,r):n==="week"?t=He(l,r):n==="month"?t=Oe(l,r):n==="quarter"?t=he(l,r):n==="year"&&(t=_e(l,r));else{const i=ge(l,r);Math.abs(i)<it?(t=ge(l,r),n="second"):Math.abs(i)<We?(t=Fe(l,r),n="minute"):Math.abs(i)<pe&&Math.abs(de(l,r))<1?(t=Re(l,r),n="hour"):Math.abs(i)<ft&&(t=de(l,r))&&Math.abs(t)<7?n="day":Math.abs(i)<ze?(t=He(l,r),n="week"):Math.abs(i)<dt?(t=Oe(l,r),n="month"):Math.abs(i)<Be&&he(l,r)<4?(t=he(l,r),n="quarter"):(t=_e(l,r),n="year")}return new Intl.RelativeTimeFormat(s==null?void 0:s.locale,{localeMatcher:s==null?void 0:s.localeMatcher,numeric:(s==null?void 0:s.numeric)||"auto",style:s==null?void 0:s.style}).format(t,n)}function gt(a){let e;const s=a[2].default,t=Ue(s,a,a[3],null);return{c(){t&&t.c()},l(n){t&&t.l(n)},m(n,l){t&&t.m(n,l),e=!0},p(n,l){t&&t.p&&(!e||l&8)&&Qe(t,s,n,n[3],e?Ge(s,n[3],l,null):Ae(n[3]),null)},i(n){e||(V(t,n),e=!0)},o(n){ee(t,n),e=!1},d(n){t&&t.d(n)}}}function mt(a){let e,s;const t=[{name:"play"},a[1],{iconNode:a[0]}];let n={$$slots:{default:[gt]},$$scope:{ctx:a}};for(let l=0;l<t.length;l+=1)n=me(n,t[l]);return e=new st({props:n}),{c(){be(e.$$.fragment)},l(l){ve(e.$$.fragment,l)},m(l,r){ke(e,l,r),s=!0},p(l,[r]){const v=r&3?et(t,[t[0],r&2&&tt(l[1]),r&1&&{iconNode:l[0]}]):{};r&8&&(v.$$scope={dirty:r,ctx:l}),e.$set(v)},i(l){s||(V(e.$$.fragment,l),s=!0)},o(l){ee(e.$$.fragment,l),s=!1},d(l){De(e,l)}}}function bt(a,e,s){let{$$slots:t={},$$scope:n}=e;const l=[["polygon",{points:"5 3 19 12 5 21 5 3"}]];return a.$$set=r=>{s(1,e=me(me({},e),Ie(r))),"$$scope"in r&&s(3,n=r.$$scope)},e=Ie(e),[l,e,t,n]}class vt extends Ne{constructor(e){super(),je(this,e,bt,mt,Ce,{})}}function Ye(a,e,s){const t=a.slice();return t[2]=e[s],t}function kt(a){let e,s;return e=new vt({props:{class:"h-4 w-4"}}),{c(){be(e.$$.fragment)},l(t){ve(e.$$.fragment,t)},m(t,n){ke(e,t,n),s=!0},p:Ze,i(t){s||(V(e.$$.fragment,t),s=!0)},o(t){ee(e.$$.fragment,t),s=!1},d(t){De(e,t)}}}function Dt(a){let e,s;return e=new nt({props:{class:"h-4 w-4",stroke:100,meter:"stroke-surface-50 dark:stroke-surface-900",value:a[2].stats.progress===void 0||a[2].stats.progress===null?void 0:a[2].stats.progress*100}}),{c(){be(e.$$.fragment)},l(t){ve(e.$$.fragment,t)},m(t,n){ke(e,t,n),s=!0},p(t,n){const l={};n&1&&(l.value=t[2].stats.progress===void 0||t[2].stats.progress===null?void 0:t[2].stats.progress*100),e.$set(l)},i(t){s||(V(e.$$.fragment,t),s=!0)},o(t){ee(e.$$.fragment,t),s=!1},d(t){De(e,t)}}}function Le(a){let e,s,t=a[1].t("tasks."+a[2].id)+"",n,l,r,v=Te.toString(a[2].schedule,{locale:a[1].language})+"",i,S,E,q=(a[2].stats.lastExecution?ce(a[2].stats.lastExecution,new Date,{locale:a[1].language}):"-")+"",K,U,F,P=a[2].stats.lastDuration?`${a[2].stats.lastDuration} ${a[1].t("settings.tasks.milliseconds")}`:"-",X,Q,H,W=(a[2].stats.nextExecution?ce(a[2].stats.nextExecution,new Date,{locale:a[1].language}):"-")+"",Z,A,R,y,Y,B,G,p,M,D,x,z,g,L,d;const oe=[Dt,kt],u=[];function h(o,f){return o[2].stats.running?0:1}return M=h(a),D=u[M]=oe[M](a),{c(){e=m("tr"),s=m("td"),n=C(t),l=T(),r=m("td"),i=C(v),S=T(),E=m("td"),K=C(q),U=T(),F=m("td"),X=C(P),Q=T(),H=m("td"),Z=C(W),A=T(),R=m("td"),y=m("form"),Y=m("input"),G=T(),p=m("button"),D.c(),z=T(),this.h()},l(o){e=b(o,"TR",{});var f=k(e);s=b(f,"TD",{});var J=k(s);n=N(J,t),J.forEach(_),l=$(f),r=b(f,"TD",{class:!0});var I=k(r);i=N(I,v),I.forEach(_),S=$(f),E=b(f,"TD",{class:!0});var se=k(E);K=N(se,q),se.forEach(_),U=$(f),F=b(f,"TD",{});var ae=k(F);X=N(ae,P),ae.forEach(_),Q=$(f),H=b(f,"TD",{class:!0});var ne=k(H);Z=N(ne,W),ne.forEach(_),A=$(f),R=b(f,"TD",{class:!0});var le=k(R);y=b(le,"FORM",{method:!0});var te=k(y);Y=b(te,"INPUT",{type:!0,name:!0}),G=$(te),p=b(te,"BUTTON",{type:!0,formaction:!0,class:!0});var re=k(p);D.l(re),re.forEach(_),te.forEach(_),le.forEach(_),z=$(f),f.forEach(_),this.h()},h(){O(r,"class","capitalize"),O(E,"class","capitalize"),O(H,"class","capitalize"),O(Y,"type","hidden"),O(Y,"name","id"),Y.value=B=a[2].id,O(p,"type","submit"),O(p,"formaction","?/runTask"),O(p,"class","btn btn-sm variant-filled disabled:!opacity-100"),p.disabled=x=a[2].stats.running,O(y,"method","post"),O(R,"class","flex items-center justify-end gap-2")},m(o,f){ue(o,e,f),c(e,s),c(s,n),c(e,l),c(e,r),c(r,i),c(e,S),c(e,E),c(E,K),c(e,U),c(e,F),c(F,X),c(e,Q),c(e,H),c(H,Z),c(e,A),c(e,R),c(R,y),c(y,Y),c(y,G),c(y,p),u[M].m(p,null),c(e,z),g=!0,L||(d=Xe(at.call(null,y)),L=!0)},p(o,f){(!g||f&3)&&t!==(t=o[1].t("tasks."+o[2].id)+"")&&j(n,t),(!g||f&3)&&v!==(v=Te.toString(o[2].schedule,{locale:o[1].language})+"")&&j(i,v),(!g||f&3)&&q!==(q=(o[2].stats.lastExecution?ce(o[2].stats.lastExecution,new Date,{locale:o[1].language}):"-")+"")&&j(K,q),(!g||f&3)&&P!==(P=o[2].stats.lastDuration?`${o[2].stats.lastDuration} ${o[1].t("settings.tasks.milliseconds")}`:"-")&&j(X,P),(!g||f&3)&&W!==(W=(o[2].stats.nextExecution?ce(o[2].stats.nextExecution,new Date,{locale:o[1].language}):"-")+"")&&j(Z,W),(!g||f&1&&B!==(B=o[2].id))&&(Y.value=B);let J=M;M=h(o),M===J?u[M].p(o,f):(Pe(),ee(u[J],1,1,()=>{u[J]=null}),qe(),D=u[M],D?D.p(o,f):(D=u[M]=oe[M](o),D.c()),V(D,1),D.m(p,null)),(!g||f&1&&x!==(x=o[2].stats.running))&&(p.disabled=x)},i(o){g||(V(D),g=!0)},o(o){ee(D),g=!1},d(o){o&&_(e),u[M].d(),L=!1,d()}}}function pt(a){let e,s=a[1].t("settings.tasks.scheduled-tasks")+"",t,n,l,r,v,i,S,E=a[1].t("settings.tasks.name")+"",q,K,U,F=a[1].t("settings.tasks.interval")+"",P,X,Q,H=a[1].t("settings.tasks.last-execution")+"",W,Z,A,R=a[1].t("settings.tasks.last-duration")+"",y,Y,B,G=a[1].t("settings.tasks.next-execution")+"",p,M,D,x,z,g,L=ye(a[0].tasks),d=[];for(let u=0;u<L.length;u+=1)d[u]=Le(Ye(a,L,u));const oe=u=>ee(d[u],1,1,()=>{d[u]=null});return{c(){e=m("h2"),t=C(s),n=T(),l=m("div"),r=m("table"),v=m("thead"),i=m("tr"),S=m("th"),q=C(E),K=T(),U=m("th"),P=C(F),X=T(),Q=m("th"),W=C(H),Z=T(),A=m("th"),y=C(R),Y=T(),B=m("th"),p=C(G),M=T(),D=m("th"),x=T(),z=m("tbody");for(let u=0;u<d.length;u+=1)d[u].c();this.h()},l(u){e=b(u,"H2",{class:!0});var h=k(e);t=N(h,s),h.forEach(_),n=$(u),l=b(u,"DIV",{class:!0});var o=k(l);r=b(o,"TABLE",{class:!0});var f=k(r);v=b(f,"THEAD",{});var J=k(v);i=b(J,"TR",{});var I=k(i);S=b(I,"TH",{});var se=k(S);q=N(se,E),se.forEach(_),K=$(I),U=b(I,"TH",{});var ae=k(U);P=N(ae,F),ae.forEach(_),X=$(I),Q=b(I,"TH",{});var ne=k(Q);W=N(ne,H),ne.forEach(_),Z=$(I),A=b(I,"TH",{});var le=k(A);y=N(le,R),le.forEach(_),Y=$(I),B=b(I,"TH",{});var te=k(B);p=N(te,G),te.forEach(_),M=$(I),D=b(I,"TH",{}),k(D).forEach(_),I.forEach(_),J.forEach(_),x=$(f),z=b(f,"TBODY",{});var re=k(z);for(let fe=0;fe<d.length;fe+=1)d[fe].l(re);re.forEach(_),f.forEach(_),o.forEach(_),this.h()},h(){O(e,"class","h2 mb-4"),O(r,"class","table table-hover [&_td]:!align-middle"),O(l,"class","table-container")},m(u,h){ue(u,e,h),c(e,t),ue(u,n,h),ue(u,l,h),c(l,r),c(r,v),c(v,i),c(i,S),c(S,q),c(i,K),c(i,U),c(U,P),c(i,X),c(i,Q),c(Q,W),c(i,Z),c(i,A),c(A,y),c(i,Y),c(i,B),c(B,p),c(i,M),c(i,D),c(r,x),c(r,z);for(let o=0;o<d.length;o+=1)d[o]&&d[o].m(z,null);g=!0},p(u,[h]){if((!g||h&2)&&s!==(s=u[1].t("settings.tasks.scheduled-tasks")+"")&&j(t,s),(!g||h&2)&&E!==(E=u[1].t("settings.tasks.name")+"")&&j(q,E),(!g||h&2)&&F!==(F=u[1].t("settings.tasks.interval")+"")&&j(P,F),(!g||h&2)&&H!==(H=u[1].t("settings.tasks.last-execution")+"")&&j(W,H),(!g||h&2)&&R!==(R=u[1].t("settings.tasks.last-duration")+"")&&j(y,R),(!g||h&2)&&G!==(G=u[1].t("settings.tasks.next-execution")+"")&&j(p,G),h&3){L=ye(u[0].tasks);let o;for(o=0;o<L.length;o+=1){const f=Ye(u,L,o);d[o]?(d[o].p(f,h),V(d[o],1)):(d[o]=Le(f),d[o].c(),V(d[o],1),d[o].m(z,null))}for(Pe(),o=L.length;o<d.length;o+=1)oe(o);qe()}},i(u){if(!g){for(let h=0;h<L.length;h+=1)V(d[h]);g=!0}},o(u){d=d.filter(Boolean);for(let h=0;h<d.length;h+=1)ee(d[h]);g=!1},d(u){u&&(_(e),_(n),_(l)),Je(d,u)}}}function Mt(a,e,s){let t;Ve(a,xe,l=>s(1,t=l));let{data:n}=e;return Ke(()=>{const l=new EventSource("/events");l.onerror=r=>console.error(r),l.addEventListener("updateStats",r=>{const v=JSON.parse(r.data);s(0,n.tasks=n.tasks.map(i=>(i.id===v.id&&(i.stats=v.stats),i)),n)})}),setInterval(()=>{s(0,n)},1e3),a.$$set=l=>{"data"in l&&s(0,n=l.data)},[n,t]}class Rt extends Ne{constructor(e){super(),je(this,e,Mt,pt,Ce,{data:0})}}export{Rt as component};
