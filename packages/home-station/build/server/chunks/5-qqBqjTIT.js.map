{"version":3,"file":"5-qqBqjTIT.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/(sidebar)/discover/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/5.js"],"sourcesContent":["import { d as db, m as marketplaceApps, c as containerEngines, a as apps } from \"../../../../chunks/db.js\";\nimport { f as fail } from \"../../../../chunks/index.js\";\nimport { d as deleteMarketplace, g as getMarketplaceAppPath } from \"../../../../chunks/marketplaces.js\";\nimport { and, eq } from \"drizzle-orm\";\nimport DockerodeCompose from \"dockerode-compose\";\nimport { g as getEngine } from \"../../../../chunks/containerengines.js\";\nimport { join } from \"node:path\";\nconst load = async () => {\n  const marketplaceApps2 = await db.query.marketplaceApps.findMany({\n    with: { marketplace: { columns: { id: true, gitRemoteUrl: true } } }\n  });\n  const marketplaces = await db.query.marketplaces.findMany({\n    columns: { gitPassword: false }\n  });\n  const containerEngines2 = await db.query.containerEngines.findMany({\n    columns: { id: true, name: true, type: true }\n  });\n  return { marketplaceApps: marketplaceApps2, marketplaces, containerEngines: containerEngines2 };\n};\nconst actions = {\n  deleteRepository: async ({ request }) => {\n    const data = await request.formData();\n    const id = data.get(\"id\")?.toString();\n    if (!id) {\n      return fail(400, { id, invalid: true });\n    }\n    await deleteMarketplace(id);\n  },\n  installApp: async ({ request }) => {\n    const data = await request.formData();\n    const appId = data.get(\"appId\")?.toString() ?? \"\";\n    const marketplaceId = data.get(\"marketplaceId\")?.toString() ?? \"\";\n    const containerEngineId = parseInt(data.get(\"containerEngineId\")?.toString() ?? \"\");\n    if (!appId) {\n      return fail(400, { appId, invalid: true });\n    }\n    if (!marketplaceId) {\n      return fail(400, { marketplaceId, invalid: true });\n    }\n    if (!containerEngineId) {\n      return fail(400, { containerEngineId, invalid: true });\n    }\n    const marketplaceApp = await db.query.marketplaceApps.findFirst({\n      where: and(\n        eq(marketplaceApps.appId, appId),\n        eq(marketplaceApps.marketplaceId, marketplaceId)\n      )\n    });\n    if (!marketplaceApp) {\n      return fail(400, { appId, notFound: true });\n    }\n    const containerEngine = await db.query.containerEngines.findFirst({\n      where: eq(containerEngines.id, containerEngineId)\n    });\n    if (!containerEngine) {\n      return fail(400, { containerEngineId, notFound: true });\n    }\n    await db.insert(apps).values({\n      appId: marketplaceApp.appId,\n      marketplaceId: marketplaceApp.marketplaceId,\n      containerEngineId: containerEngine.id,\n      installedAt: Date.now()\n    }).onConflictDoNothing();\n    const dockerode = await getEngine(containerEngine);\n    new DockerodeCompose(\n      dockerode,\n      join(getMarketplaceAppPath(marketplaceApp), \"compose.yml\"),\n      `${marketplaceApp.marketplaceId}_${marketplaceApp.appId}`\n    );\n    console.debug(appId, marketplaceId, containerEngineId);\n  }\n};\nexport {\n  actions,\n  load\n};\n","import * as server from '../entries/pages/(sidebar)/discover/_page.server.ts.js';\n\nexport const index = 5;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/(sidebar)/discover/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/(sidebar)/discover/+page.server.ts\";\nexport const imports = [\"_app/immutable/nodes/5.pqW4A2J9.js\",\"_app/immutable/chunks/scheduler.bQlOXBkt.js\",\"_app/immutable/chunks/index.dknh01mB.js\",\"_app/immutable/chunks/each.anRlpCm9.js\",\"_app/immutable/chunks/forms.uhvzcuB7.js\",\"_app/immutable/chunks/entry.qbHVI6p7.js\",\"_app/immutable/chunks/index.5bRYXlS8.js\",\"_app/immutable/chunks/popup.R-M2AyRG.js\",\"_app/immutable/chunks/stores.-cQko4Xi.js\",\"_app/immutable/chunks/ProgressBar.svelte_svelte_type_style_lang.JlGIzIKZ.js\",\"_app/immutable/chunks/ProgressRadial.xsBlPM_P.js\",\"_app/immutable/chunks/spread.rEx3vLA9.js\",\"_app/immutable/chunks/Icon.9NkTZT6r.js\",\"_app/immutable/chunks/plus.qIUUgd4x.js\",\"_app/immutable/chunks/i18n.Mah0M8rZ.js\"];\nexport const stylesheets = [\"_app/immutable/assets/ProgressBar.oq5aOWfL.css\"];\nexport const fonts = [];\n"],"names":["db"],"mappings":"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"}