{"version":3,"file":"11-BRzVmp8j.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/login/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/11.js"],"sourcesContent":["import { r as redirect, f as fail } from \"../../../chunks/index.js\";\nimport { d as db, u as users } from \"../../../chunks/db.js\";\nimport { eq } from \"drizzle-orm\";\nimport bcrypt from \"bcrypt\";\nimport { l as lucia } from \"../../../chunks/auth.js\";\nconst load = async ({ locals }) => {\n  if (locals.user)\n    return redirect(302, \"/\");\n  return {};\n};\nconst actions = {\n  default: async ({ request, cookies }) => {\n    const formData = await request.formData();\n    const username = formData.get(\"username\")?.toString();\n    const password = formData.get(\"password\")?.toString();\n    if (!username || username.length < 4 || username.length > 31) {\n      return fail(400, { incorrect: true });\n    }\n    if (!password || password.length < 6 || password.length > 255) {\n      return fail(400, { incorrect: true });\n    }\n    const existingUser = await db.query.users.findFirst({\n      where: eq(users.username, username.toLowerCase())\n    });\n    const validPassword = await bcrypt.compare(\n      password,\n      existingUser?.hashedPassword ?? \"$2b$10$BObGWttlK4uY36m7fb99YuYoulhSIsFeZ/EUiGqbwzDiTShGYTYue\"\n    );\n    if (!validPassword || !existingUser) {\n      return fail(400, { incorrect: true });\n    }\n    const session = await lucia.createSession(existingUser.id, {});\n    const sessionCookie = lucia.createSessionCookie(session.id);\n    cookies.set(sessionCookie.name, sessionCookie.value, {\n      path: \".\",\n      ...sessionCookie.attributes\n    });\n    return redirect(302, \"/\");\n  }\n};\nexport {\n  actions,\n  load\n};\n","import * as server from '../entries/pages/login/_page.server.ts.js';\n\nexport const index = 11;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/login/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/login/+page.server.ts\";\nexport const imports = [\"_app/immutable/nodes/11.5vtEHQwO.js\",\"_app/immutable/chunks/scheduler.bQlOXBkt.js\",\"_app/immutable/chunks/index.dknh01mB.js\",\"_app/immutable/chunks/forms.uhvzcuB7.js\",\"_app/immutable/chunks/entry.qbHVI6p7.js\",\"_app/immutable/chunks/index.5bRYXlS8.js\",\"_app/immutable/chunks/i18n.Mah0M8rZ.js\"];\nexport const stylesheets = [];\nexport const fonts = [];\n"],"names":["db"],"mappings":";;;;;;;;;;;;;;;;;;AAKA,MAAM,IAAI,GAAG,OAAO,EAAE,MAAM,EAAE,KAAK;AACnC,EAAE,IAAI,MAAM,CAAC,IAAI;AACjB,IAAI,OAAO,QAAQ,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;AAC9B,EAAE,OAAO,EAAE,CAAC;AACZ,CAAC,CAAC;AACF,MAAM,OAAO,GAAG;AAChB,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK;AAC3C,IAAI,MAAM,QAAQ,GAAG,MAAM,OAAO,CAAC,QAAQ,EAAE,CAAC;AAC9C,IAAI,MAAM,QAAQ,GAAG,QAAQ,CAAC,GAAG,CAAC,UAAU,CAAC,EAAE,QAAQ,EAAE,CAAC;AAC1D,IAAI,MAAM,QAAQ,GAAG,QAAQ,CAAC,GAAG,CAAC,UAAU,CAAC,EAAE,QAAQ,EAAE,CAAC;AAC1D,IAAI,IAAI,CAAC,QAAQ,IAAI,QAAQ,CAAC,MAAM,GAAG,CAAC,IAAI,QAAQ,CAAC,MAAM,GAAG,EAAE,EAAE;AAClE,MAAM,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;AAC5C,KAAK;AACL,IAAI,IAAI,CAAC,QAAQ,IAAI,QAAQ,CAAC,MAAM,GAAG,CAAC,IAAI,QAAQ,CAAC,MAAM,GAAG,GAAG,EAAE;AACnE,MAAM,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;AAC5C,KAAK;AACL,IAAI,MAAM,YAAY,GAAG,MAAMA,IAAE,CAAC,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC;AACxD,MAAM,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,QAAQ,EAAE,QAAQ,CAAC,WAAW,EAAE,CAAC;AACvD,KAAK,CAAC,CAAC;AACP,IAAI,MAAM,aAAa,GAAG,MAAM,MAAM,CAAC,OAAO;AAC9C,MAAM,QAAQ;AACd,MAAM,YAAY,EAAE,cAAc,IAAI,8DAA8D;AACpG,KAAK,CAAC;AACN,IAAI,IAAI,CAAC,aAAa,IAAI,CAAC,YAAY,EAAE;AACzC,MAAM,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;AAC5C,KAAK;AACL,IAAI,MAAM,OAAO,GAAG,MAAM,KAAK,CAAC,aAAa,CAAC,YAAY,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;AACnE,IAAI,MAAM,aAAa,GAAG,KAAK,CAAC,mBAAmB,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;AAChE,IAAI,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC,IAAI,EAAE,aAAa,CAAC,KAAK,EAAE;AACzD,MAAM,IAAI,EAAE,GAAG;AACf,MAAM,GAAG,aAAa,CAAC,UAAU;AACjC,KAAK,CAAC,CAAC;AACP,IAAI,OAAO,QAAQ,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;AAC9B,GAAG;AACH,CAAC;;;;;;;;ACrCW,MAAC,KAAK,GAAG,GAAG;AACxB,IAAI,eAAe,CAAC;AACR,MAAC,SAAS,GAAG,YAAY,eAAe,KAAK,CAAC,MAAM,OAAO,4BAAwC,CAAC,EAAE,QAAQ;AAE9G,MAAC,SAAS,GAAG,mCAAmC;AAChD,MAAC,OAAO,GAAG,CAAC,qCAAqC,CAAC,6CAA6C,CAAC,yCAAyC,CAAC,yCAAyC,CAAC,yCAAyC,CAAC,yCAAyC,CAAC,wCAAwC,EAAE;AAClT,MAAC,WAAW,GAAG,GAAG;AAClB,MAAC,KAAK,GAAG;;;;"}